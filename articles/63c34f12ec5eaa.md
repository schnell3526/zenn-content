---
title: "Pythonでテストを書く"
emoji: "🐥"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ['Python']
published: false
---
Pythonでテストを書く方法として、大きく分けて標準ライブラリのunittestを使う方法と3rdパーティ製のpytestを使う方法があります。
現在主流なのはpytestを使う方法ですのでそちらについて簡単な使い方を記します。
基本的に[公式ドキュメント](https://docs.pytest.org/en/latest/contents.html)を参考にしています。


# ソースとテストを分けない場合

```
.
└── src
    ├── fibonacci.py
    └── test_fibonacci.py
```

```python:fibonacci.py
def Fibonacci() -> int:
    ls = {0: 0, 1: 1}
    def f(n):
        nonlocal ls
        if len(ls) <= n:
            ls[n] = f(n-2) + f(n-1)
        return ls[n]
    return f
```
```python:test_fibonacci.py
from fibonacci import Fibonacci

def test_Fibonacci():
    fib = Fibonacci()
    assert fib(10) == 55
```
テストコードがソースと同じディレクトリにある場合は難しくなく、このまま`pytest`コマンドを実行することでテストが実行されます。


# ソースとテストを分ける場合
自分である程度まとまったコードを書く場合はソースとテストは分けるのが望ましいかと思います。
```
.
├── pyproject.toml
├── src
│   └── fibonacci.py
└── tests
    └── test_fibonacci.py
```
```python:test_fibonacci.py
import pytest

from src.fibonacci import Fibonacci

@pytest.mark.parametrize(('number', 'expected'),[
    (0, 0),
    (1, 1),
    (2, 1),
    (100, 354224848179261915075),
    (500, 139423224561697880139724382870407283950070256587697307264108962948325571622863290691557658876222521294125),
])
def test_fibonacci(number, expected):
    fib = Fibonacci()
    assert fib(number) == expected
```
その際、`pytest`と実行してもimportの際にエラーが出ます。
```
    from src.fibonacci import Fibonacci
E   ModuleNotFoundError: No module named 'src'
```
これの対応策の一つは`pyproject.toml`を用意してルートをインポートパスに加えることです。
```toml:pyproject.tomls
[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[project]
name = "YOUR_PACKAGE_NAME"
version = "0.0.1"
```
上のようなtomlファイルを用意し
```shell
pip install -e .
```
を実行することで、ルートからのインポートが可能になりエラーが出なくなります。